<!doctype html>
<html lang="pt-BR" data-bs-theme="auto">
<head>
    {# ... (head content as before) ... #}
    <style>
      {# ... (styles as before) ... #}

      /* Estilo para o formulário de logout (para parecer um link) */
      .logout-form {
          display: inline; /* Faz o form não quebrar linha */
          margin: 0; /* Remove margens padrão do form */
          padding: 0; /* Remove paddings padrão do form */
      }
      .logout-button {
          background: none !important; /* Remove fundo */
          border: none !important; /* Remove borda */
          padding: var(--bs-dropdown-item-padding-y) var(--bs-dropdown-item-padding-x) !important; /* Usa padding do dropdown item */
          color: var(--bs-dropdown-link-color); /* Cor padrão de link do dropdown */
          text-decoration: none; /* Remove sublinhado padrão de botão */
          cursor: pointer;
          display: block; /* Ocupa a largura toda */
          width: 100%; /* Ocupa a largura do item do dropdown */
          text-align: left; /* Alinha texto à esquerda */
          font-size: inherit; /* Usa tamanho de fonte do contexto */
          line-height: inherit; /* Usa altura de linha do contexto */
      }
      .logout-button:hover, .logout-button:focus {
           color: var(--bs-dropdown-link-hover-color); /* Cor no hover */
           background-color: var(--bs-dropdown-link-hover-bg) !important; /* Fundo no hover */
           outline: none; /* Remove outline de foco */
      }
      /* Garante que o ícone dentro do botão também mude de cor (se necessário) */
      .logout-button .bi {
          vertical-align: text-bottom; /* Alinha melhor o ícone */
      }

    </style>
</head>
<body class="d-flex flex-column min-vh-100">

    <header class="navbar navbar-expand-md navbar-dark bg-dark sticky-top">
        {# ... (navbar content as before) ... #}
                <ul class="navbar-nav ms-auto mb-2 mb-md-0">
                     {% if current_user.is_authenticated %}
                         <li class="nav-item dropdown">
                            <a class="nav-link dropdown-toggle" href="#" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                                <i class="bi bi-person-circle"></i> {{ current_user.username }}
                            </a>
                            <ul class="dropdown-menu dropdown-menu-end">
                                <li><a class="dropdown-item" href="{{ url_for('main.perfil') }}">Meu Perfil</a></li>
                                <li><hr class="dropdown-divider"></li>
                                {# Formulário POST para logout #}
                                <li>
                                    {# O formulário em si não precisa de estilo visível #}
                                    <form class="logout-form" action="{{ url_for('auth.logout') }}" method="POST">
                                        {# CORREÇÃO: Incluir o token CSRF - Flask-WTF o torna disponível #}
                                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                                        {# O botão é estilizado para parecer um link de dropdown #}
                                        <button type="submit" class="logout-button">
                                            Sair <i class="bi bi-box-arrow-right"></i>
                                        </button>
                                    </form>
                                </li>
                            </ul>
                        </li>
                     {% else %}
                        {# ... (login link as before) ... #}
                     {% endif %}
                 </ul>
                 {# ... (theme toggler as before) ... #}
            </div>
        </div>
    </header>

    <main class="container mt-4 flex-shrink-0">
        {# ... (flash messages and content block as before) ... #}
    </main>

    <footer class="footer mt-auto py-3 bg-light">
        {# ... (footer content as before) ... #}
    </footer>

    {# ... (scripts as before) ... #}

</body>
</html>
