{% extends 'base.html' %}

{% block title %}Registrar Múltiplos Pontos{% endblock %}

{% block content %}
<div class="container mt-4">
    <h1 class="h3 mb-4">Registrar Múltiplos Pontos</h1>
    
    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Preencha os dados para múltiplos dias</h6>
        </div>
        <div class="card-body">
            <form method="POST" id="formMultiploPonto">
                <div id="pontos-container">
                    <div class="ponto-row mb-4 p-3 border rounded">
                        <div class="row">
                            <div class="col-md-4 mb-3">
                                <label for="data-0">Data</label>
                                <input type="date" class="form-control" id="data-0" name="datas[]" required>
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="entrada-0">Entrada</label>
                                <input type="time" class="form-control" id="entrada-0" name="entradas[]">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="saida-almoco-0">Saída para Almoço</label>
                                <input type="time" class="form-control" id="saida-almoco-0" name="saidas_almoco[]">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="retorno-almoco-0">Retorno do Almoço</label>
                                <input type="time" class="form-control" id="retorno-almoco-0" name="retornos_almoco[]">
                            </div>
                            <div class="col-md-4 mb-3">
                                <label for="saida-0">Saída</label>
                                <input type="time" class="form-control" id="saida-0" name="saidas[]">
                            </div>
                            <div class="col-md-12 mb-3">
                                <label for="atividades-0">Atividades Realizadas</label>
                                <textarea class="form-control" id="atividades-0" name="atividades[]" rows="2"></textarea>
                            </div>
                        </div>
                    </div>
                </div>
                
                <div class="mb-3">
                    <button type="button" class="btn btn-secondary" id="addPonto">
                        <i class="fas fa-plus"></i> Adicionar Outro Dia
                    </button>
                </div>
                
                <div class="d-flex justify-content-between">
                    <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">Cancelar</a>
                    <button type="submit" class="btn btn-primary">Registrar Pontos</button>
                </div>
            </form>
        </div>
    </div>
</div>

<script>
    document.addEventListener('DOMContentLoaded', function() {
        let pontoIndex = 0;
        
        document.getElementById('addPonto').addEventListener('click', function() {
            pontoIndex++;
            
            const pontoRow = document.createElement('div');
            pontoRow.className = 'ponto-row mb-4 p-3 border rounded';
            
            pontoRow.innerHTML = `
                <div class="d-flex justify-content-between mb-2">
                    <h6 class="font-weight-bold">Registro ${pontoIndex + 1}</h6>
                    <button type="button" class="btn btn-sm btn-danger remove-ponto">
                        <i class="fas fa-times"></i> Remover
                    </button>
                </div>
                <div class="row">
                    <div class="col-md-4 mb-3">
                        <label for="data-${pontoIndex}">Data</label>
                        <input type="date" class="form-control" id="data-${pontoIndex}" name="datas[]" required>
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="entrada-${pontoIndex}">Entrada</label>
                        <input type="time" class="form-control" id="entrada-${pontoIndex}" name="entradas[]">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="saida-almoco-${pontoIndex}">Saída para Almoço</label>
                        <input type="time" class="form-control" id="saida-almoco-${pontoIndex}" name="saidas_almoco[]">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="retorno-almoco-${pontoIndex}">Retorno do Almoço</label>
                        <input type="time" class="form-control" id="retorno-almoco-${pontoIndex}" name="retornos_almoco[]">
                    </div>
                    <div class="col-md-4 mb-3">
                        <label for="saida-${pontoIndex}">Saída</label>
                        <input type="time" class="form-control" id="saida-${pontoIndex}" name="saidas[]">
                    </div>
                    <div class="col-md-12 mb-3">
                        <label for="atividades-${pontoIndex}">Atividades Realizadas</label>
                        <textarea class="form-control" id="atividades-${pontoIndex}" name="atividades[]" rows="2"></textarea>
                    </div>
                </div>
            `;
            
            document.getElementById('pontos-container').appendChild(pontoRow);
            
            // Adicionar evento para remover o ponto
            pontoRow.querySelector('.remove-ponto').addEventListener('click', function() {
                pontoRow.remove();
            });
        });
        
        // Validação do formulário
        document.getElementById('formMultiploPonto').addEventListener('submit', function(e) {
            const dataInputs = document.querySelectorAll('input[name="datas[]"]');
            let valid = false;
            
            for (const input of dataInputs) {
                if (input.value) {
                    valid = true;
                    break;
                }
            }
            
            if (!valid) {
                e.preventDefault();
                alert('Por favor, preencha pelo menos uma data para registrar ponto.');
            }
        });
    });
</script>
{% endblock %}
