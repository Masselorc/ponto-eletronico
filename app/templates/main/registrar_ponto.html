{% extends 'base.html' %}

{% block title %}Registrar Ponto{% endblock %}

{% block content %}
<div class="container mt-4">
    <div class="row mb-4">
        <div class="col-md-8">
            <h1>Registrar Ponto</h1>
            <p class="lead">Registre seu horário de trabalho</p>
        </div>
        <div class="col-md-4 text-end">
            <a href="{{ url_for('main.dashboard') }}" class="btn btn-secondary">
                <i class="fas fa-arrow-left"></i> Voltar para Dashboard
            </a>
        </div>
    </div>

    <div class="card shadow mb-4">
        <div class="card-header py-3">
            <h6 class="m-0 font-weight-bold text-primary">Formulário de Registro de Ponto</h6>
        </div>
        <div class="card-body">
            <form method="POST">
                {{ form.hidden_tag() }}
                
                <div class="mb-3">
                    <label for="data" class="form-label">Data</label>
                    {{ form.data(class="form-control", type="date", required=true) }}
                    {% if form.data.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.data.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="entrada" class="form-label">Entrada</label>
                    {{ form.entrada(class="form-control", type="time", required=true) }}
                    {% if form.entrada.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.entrada.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="saida_almoco" class="form-label">Saída para Almoço</label>
                    {{ form.saida_almoco(class="form-control", type="time") }}
                    {% if form.saida_almoco.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.saida_almoco.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="retorno_almoco" class="form-label">Retorno do Almoço</label>
                    {{ form.retorno_almoco(class="form-control", type="time") }}
                    {% if form.retorno_almoco.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.retorno_almoco.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="saida" class="form-label">Saída</label>
                    {{ form.saida(class="form-control", type="time", required=true) }}
                    {% if form.saida.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.saida.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="mb-3">
                    <label for="atividades" class="form-label">Atividades Realizadas</label>
                    {{ form.atividades(class="form-control", rows=3) }}
                    {% if form.atividades.errors %}
                    <div class="invalid-feedback d-block">
                        {% for error in form.atividades.errors %}
                        <span>{{ error }}</span>
                        {% endfor %}
                    </div>
                    {% endif %}
                </div>
                
                <div class="d-grid gap-2">
                    <button type="submit" class="btn btn-primary">
                        <i class="fas fa-save"></i> Registrar Ponto
                    </button>
                </div>
            </form>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Função para preencher campos com horário atual
    function preencherHorarioAtual(campoId) {
        const agora = new Date();
        const horas = agora.getHours().toString().padStart(2, '0');
        const minutos = agora.getMinutes().toString().padStart(2, '0');
        document.getElementById(campoId).value = `${horas}:${minutos}`;
    }
    
    // Adiciona botões para preencher com horário atual
    document.addEventListener('DOMContentLoaded', function() {
        const campos = ['entrada', 'saida_almoco', 'retorno_almoco', 'saida'];
        
        campos.forEach(campo => {
            const input = document.getElementById(campo);
            if (input) {
                const btnContainer = document.createElement('div');
                btnContainer.className = 'mt-2';
                
                const btn = document.createElement('button');
                btn.type = 'button';
                btn.className = 'btn btn-sm btn-outline-secondary';
                btn.textContent = 'Usar horário atual';
                btn.onclick = function(e) {
                    e.preventDefault();
                    preencherHorarioAtual(campo);
                };
                
                btnContainer.appendChild(btn);
                input.parentNode.appendChild(btnContainer);
            }
        });
    });
</script>
{% endblock %}
