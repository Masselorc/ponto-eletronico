{% extends 'base.html' %}

{% block title %}Editar Registro{% endblock %}

{% block content %}
<div class="row mb-4">
    <div class="col-md-6">
        <h2>Editar Registro</h2>
        <p class="text-muted">{{ ponto.data.strftime('%d/%m/%Y') }}</p>
    </div>
    <div class="col-md-6 text-end">
        <a href="{{ url_for('main.visualizar_ponto', ponto_id=ponto.id) }}" class="btn btn-outline-primary">
            <i class="fas fa-arrow-left me-2"></i>Voltar para Detalhes
        </a>
    </div>
</div>

<div class="row">
    <div class="col-md-10 mx-auto">
        <div class="card">
            <div class="card-header bg-primary text-white">
                <h5 class="mb-0">Editar Horários</h5>
            </div>
            <div class="card-body">
                <form method="POST" action="{{ url_for('main.editar_ponto', ponto_id=ponto.id) }}">
                    {{ form.hidden_tag() }}
                    
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="form-check mb-3">
                                {{ form.afastamento(class="form-check-input", id="check_afastamento", 
                                   onchange="document.getElementById('div_tipo_afastamento').style.display = this.checked ? 'block' : 'none';
                                             document.getElementById('div_horarios').style.display = this.checked ? 'none' : 'flex';
                                             document.getElementById('entrada').disabled = this.checked;
                                             document.getElementById('saida_almoco').disabled = this.checked;
                                             document.getElementById('retorno_almoco').disabled = this.checked;
                                             document.getElementById('saida').disabled = this.checked;
                                             if(this.checked) {
                                                 document.getElementById('entrada').value = '';
                                                 document.getElementById('saida_almoco').value = '';
                                                 document.getElementById('retorno_almoco').value = '';
                                                 document.getElementById('saida').value = '';
                                                 document.getElementById('tipo_afastamento').required = true;
                                             } else {
                                                 document.getElementById('tipo_afastamento').required = false;
                                             }") }}
                                {{ form.afastamento.label(class="form-check-label fw-bold") }}
                                <small class="form-text text-muted d-block">Marque esta opção para registrar férias ou outros tipos de afastamento.</small>
                            </div>
                            <div id="div_tipo_afastamento" class="mb-3" style="display: {{ 'block' if form.afastamento.data else 'none' }};">
                                {{ form.tipo_afastamento.label(class="form-label") }}
                                {{ form.tipo_afastamento(class="form-select") }}
                                <small class="form-text text-muted">Selecione o tipo de afastamento para este dia.</small>
                                <div class="alert alert-info mt-3">
                                    <i class="fas fa-info-circle me-2"></i> Ao registrar um afastamento, os campos de horário serão desabilitados automaticamente.
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4" id="div_horarios" style="display: {{ 'none' if form.afastamento.data else 'flex' }};">
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Entrada</h6>
                                </div>
                                <div class="card-body">
                                    {{ form.entrada.label(class="form-label") }}
                                    {{ form.entrada(class="form-control", id="entrada", disabled=form.afastamento.data) }}
                                    {% for error in form.entrada.errors %}
                                    <div class="text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Saída para Almoço</h6>
                                </div>
                                <div class="card-body">
                                    {{ form.saida_almoco.label(class="form-label") }}
                                    {{ form.saida_almoco(class="form-control", id="saida_almoco", disabled=form.afastamento.data) }}
                                    {% for error in form.saida_almoco.errors %}
                                    <div class="text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Retorno do Almoço</h6>
                                </div>
                                <div class="card-body">
                                    {{ form.retorno_almoco.label(class="form-label") }}
                                    {{ form.retorno_almoco(class="form-control", id="retorno_almoco", disabled=form.afastamento.data) }}
                                    {% for error in form.retorno_almoco.errors %}
                                    <div class="text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-3">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Saída</h6>
                                </div>
                                <div class="card-body">
                                    {{ form.saida.label(class="form-label") }}
                                    {{ form.saida(class="form-control", id="saida", disabled=form.afastamento.data) }}
                                    {% for error in form.saida.errors %}
                                    <div class="text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Atividades Realizadas</h6>
                                </div>
                                <div class="card-body">
                                    {{ form.atividades.label(class="form-label") }}
                                    {{ form.atividades(class="form-control", rows=4) }}
                                    <small class="form-text text-muted">{{ form.atividades.description }}</small>
                                    {% for error in form.atividades.errors %}
                                    <div class="text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row mb-4">
                        <div class="col-md-12">
                            <div class="card">
                                <div class="card-header bg-light">
                                    <h6 class="mb-0">Observações</h6>
                                </div>
                                <div class="card-body">
                                    {{ form.observacoes.label(class="form-label") }}
                                    {{ form.observacoes(class="form-control", rows=2) }}
                                    {% for error in form.observacoes.errors %}
                                    <div class="text-danger">{{ error }}</div>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-12">
                            <div class="d-grid">
                                {{ form.submit(class="btn btn-primary btn-lg") }}
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="card-footer text-center">
                <p class="text-muted mb-0">Edite os horários desejados e clique em "Atualizar Registro"</p>
            </div>
        </div>
    </div>
</div>
{% endblock %}
